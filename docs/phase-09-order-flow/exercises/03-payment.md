# æ¼”ç¿’ 3: æ”¯æ‰•ã„æ–¹æ³•é¸æŠ

## ç›®æ¨™

è³¼å…¥ãƒ•ãƒ­ãƒ¼ã® 3 ç•ªç›®ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€æ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠã™ã‚‹ç”»é¢ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```mermaid
graph LR
    A["ã‚«ãƒ¼ãƒˆç¢ºèª"] --> B["é…é€å…ˆå…¥åŠ›"]
    B --> C["æ”¯æ‰•ã„æ–¹æ³•"]
    C --> D["æ³¨æ–‡ç¢ºèª"]
    D --> E["å®Œäº†"]

    style C fill:#4caf50,color:#fff
```

---

## å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ”¯æ‰•ã„æ–¹æ³•ã®é¸æŠ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—‹ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ ã‚«ãƒ¼ãƒ‰ç•ªå·                           â”‚  â”‚
â”‚    â”‚ 4111 1111 1111 1111                 â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ æœ‰åŠ¹æœŸé™       â”‚ â”‚ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ â”‚  â”‚
â”‚    â”‚ 12/25         â”‚ â”‚ 123               â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â—‹ éŠ€è¡ŒæŒ¯è¾¼                                  â”‚
â”‚    ã”æ³¨æ–‡ç¢ºå®šå¾Œã€æŒ¯è¾¼å…ˆã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ â”‚
â”‚                                             â”‚
â”‚  â—‹ ä»£é‡‘å¼•æ›                                  â”‚
â”‚    å•†å“ãŠå±Šã‘æ™‚ã«é…é”å“¡ã«ãŠæ”¯æ‰•ã„ãã ã•ã„     â”‚
â”‚    ï¼ˆæ‰‹æ•°æ–™ Â¥330ï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            [æˆ»ã‚‹]  [æ¬¡ã¸é€²ã‚€]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‰ææ¡ä»¶

- æ¼”ç¿’ 2ï¼ˆé…é€å…ˆå…¥åŠ›ï¼‰ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨

---

## ã‚¹ãƒ†ãƒƒãƒ— 1: æ”¯æ‰•ã„æ–¹æ³•ã‚¹ã‚­ãƒ¼ãƒ

```typescript
// packages/validators/src/payment.ts
import { z } from "zod";

// ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰
const creditCardSchema = z.object({
  type: z.literal("credit_card"),
  cardNumber: z.string().regex(/^\d{13,16}$/, "ã‚«ãƒ¼ãƒ‰ç•ªå·ã¯13ã€œ16æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  expiryDate: z
    .string()
    .regex(/^(0[1-9]|1[0-2])\/\d{2}$/, "æœ‰åŠ¹æœŸé™ã¯ã€ŒMM/YYã€ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  cvv: z.string().regex(/^\d{3,4}$/, "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ã¯3ã€œ4æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  cardHolderName: z
    .string()
    .min(1, "ã‚«ãƒ¼ãƒ‰åç¾©äººã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(50, "ã‚«ãƒ¼ãƒ‰åç¾©äººã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
});

// éŠ€è¡ŒæŒ¯è¾¼
const bankTransferSchema = z.object({
  type: z.literal("bank_transfer"),
});

// ä»£é‡‘å¼•æ›
const cashOnDeliverySchema = z.object({
  type: z.literal("cash_on_delivery"),
});

// çµ±åˆã‚¹ã‚­ãƒ¼ãƒ
export const paymentMethodSchema = z.discriminatedUnion("type", [
  creditCardSchema,
  bankTransferSchema,
  cashOnDeliverySchema,
]);

export type PaymentMethod = z.infer<typeof paymentMethodSchema>;
export type PaymentType = PaymentMethod["type"];

// æ”¯æ‰•ã„æ–¹æ³•ã®è¡¨ç¤ºæƒ…å ±
export const PAYMENT_OPTIONS = [
  {
    type: "credit_card" as const,
    label: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰",
    description: "Visa, Mastercard, JCB, American Express",
    icon: "ğŸ’³",
  },
  {
    type: "bank_transfer" as const,
    label: "éŠ€è¡ŒæŒ¯è¾¼",
    description: "ã”æ³¨æ–‡ç¢ºå®šå¾Œã€æŒ¯è¾¼å…ˆã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™",
    icon: "ğŸ¦",
  },
  {
    type: "cash_on_delivery" as const,
    label: "ä»£é‡‘å¼•æ›",
    description: "å•†å“ãŠå±Šã‘æ™‚ã«ãŠæ”¯æ‰•ã„ï¼ˆæ‰‹æ•°æ–™ Â¥330ï¼‰",
    icon: "ğŸ’´",
  },
] as const;
```

---

## ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒšãƒ¼ã‚¸ã®ä½œæˆ

```tsx
// apps/web/app/checkout/payment/page.tsx
import { redirect } from "next/navigation";
import { cookies } from "next/headers";
import { PaymentForm } from "./PaymentForm";
import { StepProgress } from "../components/StepProgress";

export const metadata = {
  title: "æ”¯æ‰•ã„æ–¹æ³•",
};

export default async function PaymentPage(): Promise<JSX.Element> {
  const cookieStore = await cookies();

  // é…é€å…ˆãŒæœªå…¥åŠ›ã®å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  const shippingAddress = cookieStore.get("shippingAddress")?.value;
  if (!shippingAddress) {
    redirect("/checkout/shipping");
  }

  // ä¿å­˜æ¸ˆã¿ã®æ”¯æ‰•ã„æ–¹æ³•ã‚’å–å¾—
  const savedPayment = cookieStore.get("paymentMethod")?.value;
  const defaultValues = savedPayment ? JSON.parse(savedPayment) : undefined;

  return (
    <div className="mx-auto max-w-2xl p-4">
      <StepProgress currentStep="payment" />

      <h1 className="my-6 text-2xl font-bold">æ”¯æ‰•ã„æ–¹æ³•ã®é¸æŠ</h1>

      <PaymentForm defaultValues={defaultValues} />
    </div>
  );
}
```

---

## ã‚¹ãƒ†ãƒƒãƒ— 3: ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 3.1 æ”¯æ‰•ã„æ–¹æ³•ãƒ•ã‚©ãƒ¼ãƒ 

```tsx
// apps/web/app/checkout/payment/PaymentForm.tsx
"use client";

import { useState } from "react";
import { useActionState } from "react";
import Link from "next/link";
import { savePaymentMethod } from "./actions";
import { PAYMENT_OPTIONS, type PaymentMethod, type PaymentType } from "@ec/validators/payment";
import { CreditCardForm } from "./CreditCardForm";

type Props = {
  defaultValues?: PaymentMethod;
};

export function PaymentForm({ defaultValues }: Props): JSX.Element {
  const [selectedType, setSelectedType] = useState<PaymentType>(
    defaultValues?.type ?? "credit_card"
  );

  const [state, formAction, isPending] = useActionState(savePaymentMethod, null);

  return (
    <form
      action={formAction}
      className="space-y-6"
    >
      {/* æ”¯æ‰•ã„æ–¹æ³•ã®é¸æŠ */}
      <div className="space-y-4">
        {PAYMENT_OPTIONS.map((option) => (
          <label
            key={option.type}
            className={`block cursor-pointer rounded-lg border p-4 transition-colors ${
              selectedType === option.type ? "border-orange-500 bg-orange-50" : "hover:bg-gray-50"
            }`}
          >
            <div className="flex items-start gap-3">
              <input
                type="radio"
                name="type"
                value={option.type}
                checked={selectedType === option.type}
                onChange={(e) => setSelectedType(e.target.value as PaymentType)}
                className="mt-1"
              />

              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <span className="text-xl">{option.icon}</span>
                  <span className="font-medium">{option.label}</span>
                </div>
                <p className="mt-1 text-sm text-gray-600">{option.description}</p>

                {/* ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã®è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
                {option.type === "credit_card" && selectedType === "credit_card" && (
                  <div className="mt-4">
                    <CreditCardForm
                      defaultValues={
                        defaultValues?.type === "credit_card" ? defaultValues : undefined
                      }
                      errors={state?.errors}
                    />
                  </div>
                )}

                {/* ä»£é‡‘å¼•æ›ã®æ‰‹æ•°æ–™è¡¨ç¤º */}
                {option.type === "cash_on_delivery" && selectedType === "cash_on_delivery" && (
                  <p className="mt-2 text-sm font-medium text-orange-600">
                    â€» æ‰‹æ•°æ–™ Â¥330 ãŒè¿½åŠ ã•ã‚Œã¾ã™
                  </p>
                )}
              </div>
            </div>
          </label>
        ))}
      </div>

      {/* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
      {state?.error && <p className="text-red-600">{state.error}</p>}

      {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
      <div className="flex gap-4">
        <Link
          href="/checkout/shipping"
          className="flex-1 rounded-lg border py-3 text-center hover:bg-gray-50"
        >
          æˆ»ã‚‹
        </Link>
        <button
          type="submit"
          disabled={isPending}
          className="flex-1 rounded-lg bg-orange-500 py-3 font-bold text-white hover:bg-orange-600 disabled:cursor-not-allowed disabled:bg-gray-400"
        >
          {isPending ? "å‡¦ç†ä¸­..." : "æ¬¡ã¸é€²ã‚€"}
        </button>
      </div>
    </form>
  );
}
```

### 3.2 ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ 

```tsx
// apps/web/app/checkout/payment/CreditCardForm.tsx
"use client";

import { type PaymentMethod } from "@ec/validators/payment";

type CreditCardData = Extract<PaymentMethod, { type: "credit_card" }>;

type Props = {
  defaultValues?: CreditCardData;
  errors?: Record<string, string[]>;
};

export function CreditCardForm({ defaultValues, errors }: Props): JSX.Element {
  return (
    <div className="space-y-4 rounded-lg border bg-white p-4">
      {/* ã‚«ãƒ¼ãƒ‰ç•ªå· */}
      <div>
        <label
          htmlFor="cardNumber"
          className="mb-1 block text-sm font-medium"
        >
          ã‚«ãƒ¼ãƒ‰ç•ªå·
        </label>
        <input
          id="cardNumber"
          name="cardNumber"
          type="text"
          inputMode="numeric"
          maxLength={16}
          defaultValue={defaultValues?.cardNumber}
          placeholder="4111111111111111"
          className="w-full rounded-lg border p-3"
        />
        {errors?.cardNumber?.[0] && (
          <p className="mt-1 text-sm text-red-600">{errors.cardNumber[0]}</p>
        )}
      </div>

      {/* æœ‰åŠ¹æœŸé™ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ */}
      <div className="grid grid-cols-2 gap-4">
        <div>
          <label
            htmlFor="expiryDate"
            className="mb-1 block text-sm font-medium"
          >
            æœ‰åŠ¹æœŸé™
          </label>
          <input
            id="expiryDate"
            name="expiryDate"
            type="text"
            maxLength={5}
            defaultValue={defaultValues?.expiryDate}
            placeholder="MM/YY"
            className="w-full rounded-lg border p-3"
          />
          {errors?.expiryDate?.[0] && (
            <p className="mt-1 text-sm text-red-600">{errors.expiryDate[0]}</p>
          )}
        </div>

        <div>
          <label
            htmlFor="cvv"
            className="mb-1 block text-sm font-medium"
          >
            ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰
          </label>
          <input
            id="cvv"
            name="cvv"
            type="text"
            inputMode="numeric"
            maxLength={4}
            defaultValue={defaultValues?.cvv}
            placeholder="123"
            className="w-full rounded-lg border p-3"
          />
          {errors?.cvv?.[0] && <p className="mt-1 text-sm text-red-600">{errors.cvv[0]}</p>}
        </div>
      </div>

      {/* ã‚«ãƒ¼ãƒ‰åç¾©äºº */}
      <div>
        <label
          htmlFor="cardHolderName"
          className="mb-1 block text-sm font-medium"
        >
          ã‚«ãƒ¼ãƒ‰åç¾©äººï¼ˆãƒ­ãƒ¼ãƒå­—ï¼‰
        </label>
        <input
          id="cardHolderName"
          name="cardHolderName"
          type="text"
          defaultValue={defaultValues?.cardHolderName}
          placeholder="TARO YAMADA"
          className="w-full rounded-lg border p-3 uppercase"
        />
        {errors?.cardHolderName?.[0] && (
          <p className="mt-1 text-sm text-red-600">{errors.cardHolderName[0]}</p>
        )}
      </div>

      <p className="text-xs text-gray-500">
        â€» ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã¯ãƒ‡ãƒ¢ç”¨ã§ã™ã€‚å®Ÿéš›ã®ã‚«ãƒ¼ãƒ‰æƒ…å ±ã¯å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚
      </p>
    </div>
  );
}
```

---

## ã‚¹ãƒ†ãƒƒãƒ— 4: Server Action

```typescript
// apps/web/app/checkout/payment/actions.ts
"use server";

import { redirect } from "next/navigation";
import { cookies } from "next/headers";
import { paymentMethodSchema, type PaymentType } from "@ec/validators/payment";

export type PaymentFormState = {
  errors?: Record<string, string[]>;
  error?: string;
} | null;

export async function savePaymentMethod(
  prevState: PaymentFormState,
  formData: FormData
): Promise<PaymentFormState> {
  const type = formData.get("type") as PaymentType;

  // æ”¯æ‰•ã„æ–¹æ³•ã«å¿œã˜ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
  let paymentData: Record<string, unknown>;

  switch (type) {
    case "credit_card":
      paymentData = {
        type: "credit_card",
        cardNumber: formData.get("cardNumber"),
        expiryDate: formData.get("expiryDate"),
        cvv: formData.get("cvv"),
        cardHolderName: formData.get("cardHolderName"),
      };
      break;

    case "bank_transfer":
      paymentData = { type: "bank_transfer" };
      break;

    case "cash_on_delivery":
      paymentData = { type: "cash_on_delivery" };
      break;

    default:
      return { error: "æ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„" };
  }

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const result = paymentMethodSchema.safeParse(paymentData);

  if (!result.success) {
    return {
      errors: result.error.flatten().fieldErrors as Record<string, string[]>,
    };
  }

  // Cookie ã«ä¿å­˜ï¼ˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã¯ãƒã‚¹ã‚¯ï¼‰
  const dataToStore = { ...result.data };
  if (dataToStore.type === "credit_card") {
    // ã‚«ãƒ¼ãƒ‰ç•ªå·ã®ä¸‹4æ¡ã®ã¿ä¿å­˜
    dataToStore.cardNumber = `****${dataToStore.cardNumber.slice(-4)}`;
    // CVV ã¯ä¿å­˜ã—ãªã„
    delete (dataToStore as Record<string, unknown>).cvv;
  }

  const cookieStore = await cookies();
  cookieStore.set("paymentMethod", JSON.stringify(dataToStore), {
    httpOnly: true,
    secure: process.env.NODE_ENV === "production",
    sameSite: "lax",
    maxAge: 60 * 60 * 24, // 24æ™‚é–“
  });

  // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  redirect("/checkout/confirm");
}
```

---

## ã‚¹ãƒ†ãƒƒãƒ— 5: ã‚«ãƒ¼ãƒ‰ç•ªå·ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```tsx
// hooks/useCardNumberFormat.ts
"use client";

import { useState, type ChangeEvent } from "react";

export function useCardNumberFormat(initialValue = ""): {
  value: string;
  onChange: (e: ChangeEvent<HTMLInputElement>) => void;
  rawValue: string;
} {
  const [rawValue, setRawValue] = useState(initialValue.replace(/\s/g, ""));

  const formatCardNumber = (value: string): string => {
    // æ•°å­—ã®ã¿ã‚’æŠ½å‡º
    const digits = value.replace(/\D/g, "").slice(0, 16);
    // 4æ¡ã”ã¨ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒ¿å…¥
    return digits.replace(/(\d{4})(?=\d)/g, "$1 ");
  };

  const handleChange = (e: ChangeEvent<HTMLInputElement>): void => {
    const digits = e.target.value.replace(/\D/g, "");
    setRawValue(digits);
    e.target.value = formatCardNumber(digits);
  };

  return {
    value: formatCardNumber(rawValue),
    onChange: handleChange,
    rawValue,
  };
}
```

---

## ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

ä»¥ä¸‹ã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- [ ] æ”¯æ‰•ã„æ–¹æ³•é¸æŠãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] 3 ã¤ã®æ”¯æ‰•ã„æ–¹æ³•ã‹ã‚‰é¸æŠã§ãã‚‹
- [ ] ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰é¸æŠæ™‚ã«å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã®å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã€Œæ¬¡ã¸é€²ã‚€ã€ãƒœã‚¿ãƒ³ã§æ³¨æ–‡ç¢ºèªãƒšãƒ¼ã‚¸ã«é·ç§»ã§ãã‚‹
- [ ] ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã§é…é€å…ˆå…¥åŠ›ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Œã‚‹

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„

### æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿè£…

ã“ã®æ¼”ç¿’ã¯ãƒ‡ãƒ¢ç”¨ã§ã‚ã‚Šã€å®Ÿéš›ã®ã‚«ãƒ¼ãƒ‰æƒ…å ±ã¯å‡¦ç†ã—ã¾ã›ã‚“ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚

- **PCI DSS æº–æ‹ **: ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ç›´æ¥æ‰±ã†å ´åˆã¯ PCI DSS ã¸ã®æº–æ‹ ãŒå¿…è¦
- **æ±ºæ¸ˆä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹**: Stripe, PAY.JP ãªã©ã®æ±ºæ¸ˆä»£è¡Œã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨
- **ãƒˆãƒ¼ã‚¯ãƒ³åŒ–**: ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã—ã¦å®‰å…¨ã«å‡¦ç†
- **HTTPS å¿…é ˆ**: ã™ã¹ã¦ã®é€šä¿¡ã‚’æš—å·åŒ–

```tsx
// Stripe ã‚’ä½¿ç”¨ã—ãŸä¾‹
import { loadStripe } from "@stripe/stripe-js";
import { Elements, CardElement } from "@stripe/react-stripe-js";

const stripePromise = loadStripe("pk_test_...");

function PaymentWithStripe(): JSX.Element {
  return (
    <Elements stripe={stripePromise}>
      <CardElement />
    </Elements>
  );
}
```

---

## æ¬¡ã®æ¼”ç¿’

æ”¯æ‰•ã„æ–¹æ³•é¸æŠãŒå®Œæˆã—ãŸã‚‰ã€[æ¼”ç¿’ 4: æ³¨æ–‡ç¢ºèª](./04-order-confirm.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚
