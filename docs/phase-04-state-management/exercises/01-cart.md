# æ¼”ç¿’ 1: ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ

## ç›®æ¬¡

- [ç›®æ¨™](#ç›®æ¨™)
- [å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½](#å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½)
- [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
- [ã‚¹ãƒ†ãƒƒãƒ— 1: å‹å®šç¾©ã‚’ä½œæˆ](#ã‚¹ãƒ†ãƒƒãƒ—-1-å‹å®šç¾©ã‚’ä½œæˆ)
  - [1.1 å•†å“ã®å‹ã‚’å®šç¾©](#11-å•†å“ã®å‹ã‚’å®šç¾©)
  - [1.2 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®å‹ã‚’å®šç¾©](#12-ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®å‹ã‚’å®šç¾©)
- [ã‚¹ãƒ†ãƒƒãƒ— 2: Jotai ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](#ã‚¹ãƒ†ãƒƒãƒ—-2-jotai-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«)
  - [2.1 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã« Jotai ã‚’è¿½åŠ ](#21-ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«-jotai-ã‚’è¿½åŠ )
  - [2.2 package.json ã‚’ç¢ºèª](#22-packagejson-ã‚’ç¢ºèª)
- [ã‚¹ãƒ†ãƒƒãƒ— 3: ã‚«ãƒ¼ãƒˆ Atom ã‚’ä½œæˆ](#ã‚¹ãƒ†ãƒƒãƒ—-3-ã‚«ãƒ¼ãƒˆ-atom-ã‚’ä½œæˆ)
  - [3.1 åŸºæœ¬ã® Atom ã‚’ä½œæˆ](#31-åŸºæœ¬ã®-atom-ã‚’ä½œæˆ)
  - [3.2 æ´¾ç”Ÿ Atom ã‚’ä½œæˆ](#32-æ´¾ç”Ÿ-atom-ã‚’ä½œæˆ)
  - [3.3 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ Atom ã‚’ä½œæˆ](#33-ã‚¢ã‚¯ã‚·ãƒ§ãƒ³-atom-ã‚’ä½œæˆ)
- [ã‚¹ãƒ†ãƒƒãƒ— 4: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š](#ã‚¹ãƒ†ãƒƒãƒ—-4-ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š)
  - [4.1 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ](#41-ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ)
- [ã‚¹ãƒ†ãƒƒãƒ— 5: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ](#ã‚¹ãƒ†ãƒƒãƒ—-5-ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ)
  - [5.1 ã‚«ãƒ¼ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³](#51-ã‚«ãƒ¼ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³)
  - [5.2 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ç”¨ï¼‰](#52-ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ç”¨)
  - [5.3 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ è¡Œ](#53-ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ è¡Œ)
  - [5.4 ã‚«ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼](#54-ã‚«ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼)
- [ã‚¹ãƒ†ãƒƒãƒ— 6: ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‚’ä½œæˆ](#ã‚¹ãƒ†ãƒƒãƒ—-6-ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‚’ä½œæˆ)
- [ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
  - [localStorage ãŒå‹•ä½œã—ãªã„](#localstorage-ãŒå‹•ä½œã—ãªã„)
  - [Hydration Mismatch ã‚¨ãƒ©ãƒ¼](#hydration-mismatch-ã‚¨ãƒ©ãƒ¼)
- [ç™ºå±•èª²é¡Œ](#ç™ºå±•èª²é¡Œ)
- [å®Œäº†æ¡ä»¶](#å®Œäº†æ¡ä»¶)

## ç›®æ¨™

Jotaiã‚’ä½¿ã£ã¦ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ã“ã®ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã§ã¯ã€Atomã®åŸºæœ¬ã€æ´¾ç”ŸAtomã€æ°¸ç¶šåŒ–ã®çŸ¥è­˜ã‚’ç·åˆçš„ã«æ´»ç”¨ã—ã¾ã™ã€‚

***

## å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½

```mermaid
graph TD
    subgraph "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½"
        A["å•†å“ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ "]
        B["ã‚«ãƒ¼ãƒˆã‹ã‚‰å•†å“ã‚’å‰Šé™¤"]
        C["æ•°é‡ã‚’å¤‰æ›´"]
        D["åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—"]
        E["ã‚«ãƒ¼ãƒˆã‚’æ°¸ç¶šåŒ–"]
    end
```

- ã‚«ãƒ¼ãƒˆã¸ã®å•†å“è¿½åŠ 
- ã‚«ãƒ¼ãƒˆã‹ã‚‰å•†å“ã‚’å‰Šé™¤
- å•†å“ã®æ•°é‡å¤‰æ›´
- ã‚«ãƒ¼ãƒˆå†…ã®åˆè¨ˆé‡‘é¡è¨ˆç®—
- ã‚«ãƒ¼ãƒˆå†…å®¹ã‚’localStorageã«æ°¸ç¶šåŒ–

***

## å‰ææ¡ä»¶

ä»¥ä¸‹ã®ç’°å¢ƒãŒæ•´ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# Node.js 24+
node --version

# pnpm 10+
pnpm --version

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã§ãã‚‹ã“ã¨
pnpm dev
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 1: å‹å®šç¾©ã‚’ä½œæˆ

### 1.1 å•†å“ã®å‹ã‚’å®šç¾©

```typescript
// packages/shared/src/types/product.ts
export type Product = {
  id: string;
  name: string;
  price: number;
  description: string;
  imageUrl: string;
  categoryId: string;
};
```

### 1.2 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®å‹ã‚’å®šç¾©

```typescript
// packages/store/src/types/cart.ts
export type CartItem = {
  productId: string;
  name: string;
  price: number;
  quantity: number;
  imageUrl: string;
};
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 2: Jotai ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 2.1 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã« Jotai ã‚’è¿½åŠ 

```bash
# packages/store ã« Jotai ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd packages/store
pnpm add jotai
```

### 2.2 package.json ã‚’ç¢ºèª

```json
// packages/store/package.json
{
  "name": "@ec/store",
  "version": "0.0.1",
  "private": true,
  "exports": {
    ".": "./src/index.ts",
    "./cart": "./src/cart.ts"
  },
  "dependencies": {
    "jotai": "^2.0.0"
  },
  "devDependencies": {
    "@ec/typescript-config": "workspace:*",
    "typescript": "^5.9.0"
  }
}
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 3: ã‚«ãƒ¼ãƒˆ Atom ã‚’ä½œæˆ

### 3.1 åŸºæœ¬ã® Atom ã‚’ä½œæˆ

```typescript
// packages/store/src/cart.ts
import { atom } from "jotai";
import { atomWithStorage } from "jotai/utils";

// ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®å‹
export type CartItem = {
  productId: string;
  name: string;
  price: number;
  quantity: number;
  imageUrl: string;
};

// ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç®¡ç†ã™ã‚‹ Atomï¼ˆlocalStorage ã«æ°¸ç¶šåŒ–ï¼‰
export const cartItemsAtom = atomWithStorage<CartItem[]>("ec-cart", []);
```

### 3.2 æ´¾ç”Ÿ Atom ã‚’ä½œæˆ

```typescript
// packages/store/src/cart.tsï¼ˆç¶šãï¼‰

// ã‚«ãƒ¼ãƒˆå†…ã®åˆè¨ˆã‚¢ã‚¤ãƒ†ãƒ æ•°
export const cartItemCountAtom = atom((get) => {
  const items = get(cartItemsAtom);
  return items.reduce((sum, item) => sum + item.quantity, 0);
});

// ã‚«ãƒ¼ãƒˆã®å°è¨ˆï¼ˆç¨æŠœï¼‰
export const cartSubtotalAtom = atom((get) => {
  const items = get(cartItemsAtom);
  return items.reduce((sum, item) => sum + item.price * item.quantity, 0);
});

// æ¶ˆè²»ç¨ç‡
export const taxRateAtom = atom(0.1);

// æ¶ˆè²»ç¨é¡
export const cartTaxAtom = atom((get) => {
  const subtotal = get(cartSubtotalAtom);
  const taxRate = get(taxRateAtom);
  return Math.floor(subtotal * taxRate);
});

// åˆè¨ˆé‡‘é¡ï¼ˆç¨è¾¼ï¼‰
export const cartTotalAtom = atom((get) => {
  const subtotal = get(cartSubtotalAtom);
  const tax = get(cartTaxAtom);
  return subtotal + tax;
});
```

### 3.3 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ Atom ã‚’ä½œæˆ

```typescript
// packages/store/src/cart.tsï¼ˆç¶šãï¼‰

// ã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ 
export const addToCartAtom = atom(null, (get, set, newItem: CartItem) => {
  const items = get(cartItemsAtom);
  const existingItem = items.find((item) => item.productId === newItem.productId);

  if (existingItem) {
    // æ—¢å­˜ã‚¢ã‚¤ãƒ†ãƒ ã®æ•°é‡ã‚’å¢—ã‚„ã™
    const updatedItems = items.map((item) =>
      item.productId === newItem.productId
        ? { ...item, quantity: item.quantity + newItem.quantity }
        : item
    );
    set(cartItemsAtom, updatedItems);
  } else {
    // æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
    set(cartItemsAtom, [...items, newItem]);
  }
});

// ã‚«ãƒ¼ãƒˆã‹ã‚‰å•†å“ã‚’å‰Šé™¤
export const removeFromCartAtom = atom(null, (get, set, productId: string) => {
  const items = get(cartItemsAtom);
  const filteredItems = items.filter((item) => item.productId !== productId);
  set(cartItemsAtom, filteredItems);
});

// å•†å“ã®æ•°é‡ã‚’æ›´æ–°
export const updateQuantityAtom = atom(
  null,
  (get, set, { productId, quantity }: { productId: string; quantity: number }) => {
    if (quantity <= 0) {
      // 0 ä»¥ä¸‹ã®å ´åˆã¯å‰Šé™¤
      const items = get(cartItemsAtom);
      set(
        cartItemsAtom,
        items.filter((item) => item.productId !== productId)
      );
      return;
    }

    const items = get(cartItemsAtom);
    const updatedItems = items.map((item) =>
      item.productId === productId ? { ...item, quantity } : item
    );
    set(cartItemsAtom, updatedItems);
  }
);

// ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
export const clearCartAtom = atom(null, (_get, set) => {
  set(cartItemsAtom, []);
});
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 4: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š

### 4.1 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```typescript
// packages/store/src/index.ts
export * from "./cart";
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 5: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ

### 5.1 ã‚«ãƒ¼ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³

```tsx
// apps/web/components/AddToCartButton.tsx
"use client";

import { useSetAtom } from "jotai";
import { addToCartAtom, type CartItem } from "@ec/store/cart";

type AddToCartButtonProps = {
  product: {
    id: string;
    name: string;
    price: number;
    imageUrl: string;
  };
  quantity?: number;
};

export function AddToCartButton({ product, quantity = 1 }: AddToCartButtonProps): JSX.Element {
  const addToCart = useSetAtom(addToCartAtom);

  const handleClick = (): void => {
    const cartItem: CartItem = {
      productId: product.id,
      name: product.name,
      price: product.price,
      quantity,
      imageUrl: product.imageUrl,
    };
    addToCart(cartItem);
  };

  return (
    <button
      onClick={handleClick}
      className="rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-600"
    >
      ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
    </button>
  );
}
```

### 5.2 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ç”¨ï¼‰

```tsx
// apps/web/components/CartIcon.tsx
"use client";

import { useAtomValue } from "jotai";
import { cartItemCountAtom } from "@ec/store/cart";
import Link from "next/link";

export function CartIcon(): JSX.Element {
  const itemCount = useAtomValue(cartItemCountAtom);

  return (
    <Link
      href="/cart"
      className="relative"
    >
      <span className="text-2xl">ğŸ›’</span>
      {itemCount > 0 && (
        <span className="absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs text-white">
          {itemCount > 99 ? "99+" : itemCount}
        </span>
      )}
    </Link>
  );
}
```

### 5.3 ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ è¡Œ

```tsx
// apps/web/components/CartItemRow.tsx
"use client";

import { useSetAtom } from "jotai";
import { updateQuantityAtom, removeFromCartAtom, type CartItem } from "@ec/store/cart";

type CartItemRowProps = {
  item: CartItem;
};

export function CartItemRow({ item }: CartItemRowProps): JSX.Element {
  const updateQuantity = useSetAtom(updateQuantityAtom);
  const removeFromCart = useSetAtom(removeFromCartAtom);

  const handleQuantityChange = (e: React.ChangeEvent<HTMLSelectElement>): void => {
    const quantity = parseInt(e.target.value, 10);
    updateQuantity({ productId: item.productId, quantity });
  };

  const handleRemove = (): void => {
    removeFromCart(item.productId);
  };

  return (
    <div className="flex items-center justify-between border-b py-4">
      <div className="flex items-center gap-4">
        <img
          src={item.imageUrl}
          alt={item.name}
          className="h-20 w-20 rounded object-cover"
        />
        <div>
          <h3 className="font-bold">{item.name}</h3>
          <p className="text-gray-600">Â¥{item.price.toLocaleString()}</p>
        </div>
      </div>
      <div className="flex items-center gap-4">
        <select
          value={item.quantity}
          onChange={handleQuantityChange}
          className="rounded border px-3 py-1"
        >
          {Array.from({ length: 10 }, (_, i) => i + 1).map((n) => (
            <option
              key={n}
              value={n}
            >
              {n}
            </option>
          ))}
        </select>
        <p className="min-w-24 text-right font-bold">
          Â¥{(item.price * item.quantity).toLocaleString()}
        </p>
        <button
          onClick={handleRemove}
          className="text-red-500 hover:text-red-700"
          aria-label="å‰Šé™¤"
        >
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  );
}
```

### 5.4 ã‚«ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼

```tsx
// apps/web/components/CartSummary.tsx
"use client";

import { useAtomValue, useSetAtom } from "jotai";
import { cartSubtotalAtom, cartTaxAtom, cartTotalAtom, clearCartAtom } from "@ec/store/cart";

export function CartSummary(): JSX.Element {
  const subtotal = useAtomValue(cartSubtotalAtom);
  const tax = useAtomValue(cartTaxAtom);
  const total = useAtomValue(cartTotalAtom);
  const clearCart = useSetAtom(clearCartAtom);

  return (
    <div className="rounded bg-gray-100 p-4">
      <h2 className="mb-4 text-xl font-bold">æ³¨æ–‡æ¦‚è¦</h2>
      <div className="space-y-2">
        <div className="flex justify-between">
          <span>å°è¨ˆ</span>
          <span>Â¥{subtotal.toLocaleString()}</span>
        </div>
        <div className="flex justify-between">
          <span>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</span>
          <span>Â¥{tax.toLocaleString()}</span>
        </div>
        <div className="flex justify-between border-t pt-2 text-xl font-bold">
          <span>åˆè¨ˆ</span>
          <span>Â¥{total.toLocaleString()}</span>
        </div>
      </div>
      <button className="mt-4 w-full rounded bg-green-500 py-3 text-white hover:bg-green-600">
        è³¼å…¥æ‰‹ç¶šãã¸
      </button>
      <button
        onClick={clearCart}
        className="mt-2 w-full rounded border py-2 text-gray-600 hover:bg-gray-50"
      >
        ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã™ã‚‹
      </button>
    </div>
  );
}
```

***

## ã‚¹ãƒ†ãƒƒãƒ— 6: ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‚’ä½œæˆ

```tsx
// apps/web/app/cart/page.tsx
"use client";

import { useAtomValue } from "jotai";
import { cartItemsAtom } from "@ec/store/cart";
import { CartItemRow } from "@/components/CartItemRow";
import { CartSummary } from "@/components/CartSummary";
import Link from "next/link";

export default function CartPage(): JSX.Element {
  const items = useAtomValue(cartItemsAtom);

  if (items.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center py-20">
        <p className="mb-4 text-xl text-gray-600">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>
        <Link
          href="/products"
          className="rounded bg-blue-500 px-6 py-2 text-white hover:bg-blue-600"
        >
          å•†å“ã‚’è¦‹ã‚‹
        </Link>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="mb-8 text-2xl font-bold">ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ</h1>
      <div className="grid gap-8 lg:grid-cols-3">
        <div className="lg:col-span-2">
          {items.map((item) => (
            <CartItemRow
              key={item.productId}
              item={item}
            />
          ))}
        </div>
        <div>
          <CartSummary />
        </div>
      </div>
    </div>
  );
}
```

***

## ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- [ ] å•†å“ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã§ãã‚‹
- [ ] ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã§å•†å“ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å•†å“ã®æ•°é‡ã‚’å¤‰æ›´ã§ãã‚‹
- [ ] å•†å“ã‚’å‰Šé™¤ã§ãã‚‹
- [ ] å°è¨ˆã€æ¶ˆè²»ç¨ã€åˆè¨ˆé‡‘é¡ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹
- [ ] ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã‚«ãƒ¼ãƒˆã®å†…å®¹ãŒä¿æŒã•ã‚Œã‚‹
- [ ] ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã§ãã‚‹
- [ ] ã‚«ãƒ¼ãƒˆãŒç©ºã®ã¨ãã«ã€Œã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

***

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### localStorage ãŒå‹•ä½œã—ãªã„

SSRç’°å¢ƒã§ã¯localStorageã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
`"use client"` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Hydration Mismatch ã‚¨ãƒ©ãƒ¼

ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å€¤ãŒç•°ãªã‚‹å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚
Suspenseã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®ã¿è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

```tsx
"use client";

import { useEffect, useState } from "react";

export function ClientOnly({ children }: { children: React.ReactNode }): JSX.Element | null {
  const [isMounted, setIsMounted] = useState(false);

  useEffect(() => {
    setIsMounted(true);
  }, []);

  if (!isMounted) return null;

  return <>{children}</>;
}
```

***

## ç™ºå±•èª²é¡Œ

1. **æ•°é‡åˆ¶é™ã®è¿½åŠ **
   - åœ¨åº«æ•°ã‚’è¶…ãˆã¦è¿½åŠ ã§ããªã„ã‚ˆã†ã«ã™ã‚‹

2. **ã‚«ãƒ¼ãƒˆè¿½åŠ æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒˆãƒ¼ã‚¹ãƒˆã‚„ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è¿½åŠ å®Œäº†ã‚’è¡¨ç¤º

3. **undo æ©Ÿèƒ½**
   - å‰Šé™¤ã—ãŸå•†å“ã‚’å…ƒã¸æˆ»ã›ã‚‹æ©Ÿèƒ½ã®è¿½åŠ 

4. **ã‚¯ãƒ¼ãƒãƒ³é©ç”¨æ©Ÿèƒ½**
   - ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦å‰²å¼•ã‚’é©ç”¨

***

## å®Œäº†æ¡ä»¶

ä»¥ä¸‹ãŒã™ã¹ã¦å‹•ä½œã™ã‚Œã°ã€ã“ã®æ¼”ç¿’ã¯å®Œäº†ã§ã™ã€‚

- ã‚«ãƒ¼ãƒˆã¸ã®è¿½åŠ /å‰Šé™¤ãŒå‹•ä½œã™ã‚‹
- æ•°é‡å¤‰æ›´ãŒå‹•ä½œã™ã‚‹
- åˆè¨ˆé‡‘é¡ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹
- ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã‚«ãƒ¼ãƒˆãŒä¿æŒã•ã‚Œã‚‹

æ¬¡ã¯ [æ¼”ç¿’ 2: ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½](./02-favorites.md) ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚
